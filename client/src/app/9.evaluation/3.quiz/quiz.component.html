<mat-card class="quiz-container">
  <mat-card-title>
    <span>Quiz</span>
  </mat-card-title>
  <mat-card-content>
    <div *ngFor="let eachQuiz of quizzes" class="quiz-item">
      <mat-card class="sub-card">
        <p>{{ eachQuiz.question }}</p>
        <p>{{ eachQuiz.answer }}</p>
        <mat-radio-group [(ngModel)]="eachQuiz.selectedAnswer">
          <mat-radio-button
            *ngFor="let option of eachQuiz.options; let i = index"
            [value]="i"
          >
            <span
              [ngClass]="{
                'correct-answer': eachQuiz.answered && i === eachQuiz.answer,
                'wrong-answer':
                  eachQuiz.answered &&
                  i === eachQuiz.selectedAnswer &&
                  i !== eachQuiz.answer
              }"
            >
              {{ option }}
              <mat-icon
                *ngIf="eachQuiz.answered"
                [ngClass]="{
                  'success-icon': i === eachQuiz.answer,
                  'error-icon': i !== eachQuiz.answer
                }"
              >
                {{ i === eachQuiz.answer ? "check_circle" : "cancel" }}
              </mat-icon>
            </span>
          </mat-radio-button>
        </mat-radio-group>
        <div *ngIf="eachQuiz.answered && eachQuiz.feedback" class="feedback-message" [ngClass]="{'correct-feedback': eachQuiz.selectedAnswer === eachQuiz.answer, 'wrong-feedback': eachQuiz.selectedAnswer !== eachQuiz.answer}">
          {{ eachQuiz.feedback }}
        </div>
        <!-- Ask Bot Button -->
        <div class="ask-bot-container">
          <button mat-raised-button color="accent" class="ask-bot-button" (click)="askBot(eachQuiz.question)">
            <mat-icon class="bot-icon">smart_toy</mat-icon>
            Ask Bot
          </button>
        </div>

      </mat-card>
    </div>
    <div class="button-container">
      <button
        mat-raised-button
        class="submit-button"
        (click)="submitAnswers()"
        [disabled]="!isAnyQuizAttempted()"
      >
        Submit
      </button>
      <button mat-raised-button class="reset-button" (click)="resetQuiz()">
        Reset
      </button>
    </div>
  </mat-card-content>
</mat-card>

<!-- Chatbot UI -->
<div *ngIf="showBot" class="bot-container">
  <mat-card class="bot-card">
    <mat-card-title>
      <mat-icon>smart_toy</mat-icon>
      <span>Quiz Assistant</span>
      <button mat-icon-button class="exit-button" (click)="closeBot()">
        <mat-icon>close</mat-icon>
      </button>
    </mat-card-title>

    <!-- Scrollable Messages -->
    <div class="chat-messages">
      <div *ngIf="botQuestion" class="bot-message"><strong>Q:</strong> {{ botQuestion }}</div>
      <div *ngIf="botResponse" class="bot-message">{{ botResponse }}</div>
    </div>

    <!-- Chat Input -->
    <div class="bot-input-container">
      <input
        class="bot-input"
        [(ngModel)]="userQuery"
        placeholder="Ask a follow-up question..."
        (keyup.enter)="sendBotQuery()"
      />
      <button class="send-button" (click)="sendBotQuery()">Send</button>
    </div>
  </mat-card>
</div>
