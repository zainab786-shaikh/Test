<mat-card class="quiz-container">
  <mat-card-title>
    <span>Fill in the Blank</span>
  </mat-card-title>
  <mat-card-content>
    <div *ngFor="let eachFillBlank of fillBlanks" class="quiz-item">
      <mat-card class="sub-card">
        <p>
          <span>{{ eachFillBlank.question.split("______")[0] }}</span>
          <mat-select
            [(ngModel)]="eachFillBlank.selectedAnswer"
            class="blank-dropdown"
          >
            <mat-option
              *ngFor="let option of eachFillBlank.options; let i = index"
              [value]="i"
            >
              {{ option }}
            </mat-option>
          </mat-select>
          <span>{{ eachFillBlank.question.split("______")[1] }}</span>
        </p>
        <p>{{ eachFillBlank.answer }}</p>
        <mat-icon
          *ngIf="eachFillBlank.answered"
          [ngClass]="{
              'success-icon':
                eachFillBlank.answered &&
                eachFillBlank.selectedAnswer === eachFillBlank.answer,
              'error-icon':
                eachFillBlank.answered &&
                eachFillBlank.selectedAnswer !== eachFillBlank.answer
          }"
        >
          {{ eachFillBlank.selectedAnswer === eachFillBlank.answer ?
          "check_circle" : "cancel" }}
        </mat-icon>
        <div
          *ngIf="eachFillBlank.answered && eachFillBlank.feedback"
          class="feedback-message"
          [ngClass]="{
            'correct-feedback': eachFillBlank.selectedAnswer === eachFillBlank.answer,
            'wrong-feedback': eachFillBlank.selectedAnswer !== eachFillBlank.answer
          }"
        >
          {{ eachFillBlank.feedback }}
        </div>

        <!-- Ask Bot Button -->
        <div class="ask-bot-container">
          <button mat-raised-button color="accent" class="ask-bot-button" (click)="askBot(eachFillBlank.question)">
            <mat-icon class="bot-icon">smart_toy</mat-icon>
            Ask Bot
          </button>
        </div>
      </mat-card>
    </div>
    <div class="button-container">
      <button
        mat-raised-button
        color="primary"
        (click)="submitAnswers()"
        [disabled]="!isAnyAnswerSelected()"
      >
        Submit
      </button>
      <button mat-raised-button color="primary" (click)="resetFillBlank()">
        Reset
      </button>
    </div>
  </mat-card-content>
</mat-card>


<!-- Chatbot UI -->
<div *ngIf="showBot" class="bot-container">
  <mat-card class="bot-card">
    <mat-card-title>
      <mat-icon>smart_toy</mat-icon>
      <span>Quiz Assistant</span>
      <button mat-icon-button class="exit-button" (click)="closeBot()">
        <mat-icon>close</mat-icon>
      </button>
    </mat-card-title>

    <!-- Scrollable Messages -->
    <div class="chat-messages">
      <div *ngIf="botQuestion" class="bot-message"><strong>Q:</strong> {{ botQuestion }}</div>
      <div *ngIf="botResponse" class="bot-message">{{ botResponse }}</div>
    </div>

    <!-- Chat Input -->
    <div class="bot-input-container">
      <input
        class="bot-input"
        [(ngModel)]="userQuery"
        placeholder="Ask a follow-up question..."
        (keyup.enter)="sendBotQuery()"
      />
      <button class="send-button" (click)="sendBotQuery()">Send</button>
    </div>
  </mat-card>
</div>
